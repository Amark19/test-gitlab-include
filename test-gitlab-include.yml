.set_config:
  script:
    - echo "Setting config vars..."
    - echo "BROWSERSTACK_USERNAME=${BROWSERSTACK_USERNAME}" > config.env
    - echo "BROWSERSTACK_ACCESS_KEY=${BROWSERSTACK_ACCESS_KEY}" >> config.env
    - echo "BROWSERSTACK_BUILD_NAME=AMAR-D-HERO" >> config.env
    - cat config.env
  artifacts:
    paths:
      - config.env

.report_plugin:
  image: alpine:latest
  script: |
    source config.env
    # Constants
    API_PATH="https://cad-report.vercel.app/api/v1/builds/buildReport"
    REPORT_STATUS_COMPLETED="COMPLETED"
    REPORT_STATUS_NOT_AVAILABLE="NOT_AVAILABLE"
    REPORT_STATUS_TEST_AVAILABLE="TEST_AVAILABLE"
    REPORT_STATUS_IN_PROGRESS="IN_PROGRESS"
    REQUESTING_CI="circle-ci"
    REPORT_FORMAT='["plainText", "richHtml"]'
    
    # Error scenario mappings
    declare -A ERROR_SCENARIOS=(
      ["BUILD_NOT_FOUND"]="Build not found in BrowserStack"
      ["MULTIPLE_BUILD_FOUND"]="Multiple builds found with the same name"
      ["DATA_NOT_AVAILABLE"]="Report data not available from BrowserStack"
    )
      
    
    # Ensure pipeline doesn't exit with non-zero status
    exit 0
  artifacts:
    paths:
      - browserstack-testreport.html
